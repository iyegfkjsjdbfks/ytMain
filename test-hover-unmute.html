<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hover Autoplay & Unmute Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-6xl mx-auto">
        <h1 class="text-4xl font-bold mb-8 text-center text-gray-800">üéµ Hover Autoplay & Unmute Test</h1>
        
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
            <!-- Home Page Test -->
            <div class="bg-white p-6 rounded-lg shadow-lg">
                <h2 class="text-2xl font-semibold mb-4 text-blue-600">üè† Home Page Test</h2>
                <ol class="list-decimal list-inside space-y-2 mb-4">
                    <li>Go to <a href="http://localhost:3000/" class="text-blue-600 underline" target="_blank">Home Page</a></li>
                    <li>Wait for video cards to load</li>
                    <li>Hover over any video card</li>
                    <li>Wait 0.5 seconds for autoplay</li>
                    <li>Look for mute/unmute button (bottom-left of video)</li>
                    <li>Click the button to unmute</li>
                </ol>
                <div class="bg-green-50 p-3 rounded border-l-4 border-green-400">
                    <p class="text-green-700"><strong>Expected:</strong> Video should autoplay muted, then unmute when you click the speaker button</p>
                </div>
            </div>

            <!-- Search Page Test -->
            <div class="bg-white p-6 rounded-lg shadow-lg">
                <h2 class="text-2xl font-semibold mb-4 text-purple-600">üîç Search Page Test</h2>
                <ol class="list-decimal list-inside space-y-2 mb-4">
                    <li>Go to <a href="http://localhost:3000/search?q=halo" class="text-purple-600 underline" target="_blank">Search Page</a></li>
                    <li>Wait for search results to load</li>
                    <li>Hover over any video card</li>
                    <li>Wait 0.5 seconds for autoplay</li>
                    <li>Look for mute/unmute button (bottom-left of video)</li>
                    <li>Click the button to unmute</li>
                </ol>
                <div class="bg-green-50 p-3 rounded border-l-4 border-green-400">
                    <p class="text-green-700"><strong>Expected:</strong> Video should autoplay muted, then unmute when you click the speaker button</p>
                </div>
            </div>
        </div>

        <!-- Debug Console Script -->
        <div class="bg-gray-900 text-white p-6 rounded-lg mb-8">
            <h3 class="text-xl font-semibold mb-4 text-green-400">üõ†Ô∏è Debug Script (Paste in Browser Console)</h3>
            <pre class="text-sm overflow-x-auto bg-gray-800 p-4 rounded"><code>// Enhanced debug script for hover autoplay and unmute functionality
console.log('üéµ Starting Enhanced Hover Autoplay Debug');

setTimeout(() => {
  console.log('üìç Current URL:', window.location.href);
  
  // Check for video cards
  const videoCards = document.querySelectorAll('[class*="group cursor-pointer"]');
  console.log('üìπ Video cards found:', videoCards.length);
  
  if (videoCards.length > 0) {
    const firstCard = videoCards[0];
    
    // Check structure
    const thumbnail = firstCard.querySelector('img[alt]');
    const watchLink = firstCard.querySelector('a[href*="/watch/"]');
    
    console.log('üñºÔ∏è Thumbnail:', !!thumbnail);
    console.log('üîó Watch link:', !!watchLink);
    
    if (watchLink) {
      const videoId = watchLink.href.match(/\/watch\/(.+)$/)?.[1];
      console.log('üÜî Raw video ID:', videoId);
      
      // Test ID extraction logic
      let extractedId = null;
      if (videoId?.startsWith('youtube-')) {
        extractedId = videoId.replace('youtube-', '');
      } else if (videoId?.startsWith('google-search-')) {
        extractedId = videoId.replace('google-search-', '');
      } else if (videoId?.length === 11 && /^[a-zA-Z0-9_-]+$/.test(videoId)) {
        extractedId = videoId;
      }
      
      console.log('üé¨ Extracted YouTube ID:', extractedId);
      console.log('‚úÖ Valid for autoplay:', extractedId && extractedId.length === 11);
      
      if (extractedId && extractedId.length === 11) {
        console.log('üéØ Testing hover autoplay and unmute...');
        
        // Simulate hover
        firstCard.dispatchEvent(new MouseEvent('mouseenter', { bubbles: true }));
        
        setTimeout(() => {
          const badge = firstCard.querySelector('[class*="bg-red-600"]');
          console.log('üè∑Ô∏è Preview badge:', !!badge);
          
          setTimeout(() => {
            const iframe = firstCard.querySelector('iframe[src*="youtube-nocookie.com"]');
            const muteButton = firstCard.querySelector('button[title*="mute"], button[title*="Mute"]');
            
            console.log('üé¨ Iframe loaded:', !!iframe);
            console.log('üîä Mute button found:', !!muteButton);
            
            if (iframe) {
              console.log('‚úÖ SUCCESS! Iframe src:', iframe.src);
              console.log('üîá Video starts muted:', iframe.src.includes('mute=1'));
              
              if (muteButton) {
                console.log('üéµ Mute button available - testing click...');
                console.log('üîä Button title:', muteButton.getAttribute('title'));
                
                // Test button click
                setTimeout(() => {
                  console.log('üñ±Ô∏è Clicking unmute button...');
                  muteButton.click();
                  
                  setTimeout(() => {
                    const newIframe = firstCard.querySelector('iframe[src*="youtube-nocookie.com"]');
                    if (newIframe) {
                      console.log('üéµ After unmute - iframe src:', newIframe.src);
                      console.log('üîä Video should be unmuted:', newIframe.src.includes('mute=0'));
                    }
                  }, 1000);
                }, 1000);
              } else {
                console.log('‚ùå No mute button found');
              }
            } else {
              console.log('‚ùå No iframe found');
            }
            
            // Clean up after test
            setTimeout(() => {
              firstCard.dispatchEvent(new MouseEvent('mouseleave', { bubbles: true }));
              console.log('‚úÖ Test completed - cleaned up hover state');
            }, 5000);
          }, 700);
        }, 200);
      } else {
        console.log('‚ùå Invalid video ID - hover won\'t work');
      }
    }
  } else {
    console.log('‚ùå No video cards found');
    console.log('üí° Make sure you\'re on the home page or search page with videos loaded');
  }
}, 2000);

console.log('‚úÖ Enhanced debug script loaded - waiting 2 seconds...');</code></pre>
        </div>

        <!-- Feature Overview -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
            <div class="bg-blue-50 border border-blue-200 p-6 rounded-lg">
                <h3 class="text-lg font-semibold text-blue-800 mb-3">üé¨ Hover Autoplay Features</h3>
                <ul class="space-y-2 text-blue-700">
                    <li>‚úÖ 0.5 second hover delay</li>
                    <li>‚úÖ Muted autoplay (browser-compliant)</li>
                    <li>‚úÖ 30-second preview loop</li>
                    <li>‚úÖ Smooth thumbnail ‚Üî video transitions</li>
                    <li>‚úÖ Red "Preview" badge indicator</li>
                    <li>‚úÖ Error handling for unembeddable videos</li>
                </ul>
            </div>

            <div class="bg-green-50 border border-green-200 p-6 rounded-lg">
                <h3 class="text-lg font-semibold text-green-800 mb-3">üîä NEW: Unmute Functionality</h3>
                <ul class="space-y-2 text-green-700">
                    <li>‚úÖ Mute/unmute button on hover previews</li>
                    <li>‚úÖ Located bottom-left of video player</li>
                    <li>‚úÖ Visual speaker icon (muted/unmuted)</li>
                    <li>‚úÖ Tooltip shows current state</li>
                    <li>‚úÖ Instant audio toggle</li>
                    <li>‚úÖ Resets to muted on next hover</li>
                </ul>
            </div>
        </div>

        <!-- Troubleshooting -->
        <div class="bg-yellow-50 border border-yellow-200 p-6 rounded-lg">
            <h3 class="text-lg font-semibold text-yellow-800 mb-3">üîß Troubleshooting</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-yellow-700">
                <div>
                    <h4 class="font-semibold mb-2">Common Issues:</h4>
                    <ul class="space-y-1">
                        <li>‚Ä¢ No video cards: Search results not loaded</li>
                        <li>‚Ä¢ No autoplay: Invalid video IDs</li>
                        <li>‚Ä¢ No unmute button: Iframe not loading</li>
                        <li>‚Ä¢ Button not working: JavaScript errors</li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-semibold mb-2">Solutions:</h4>
                    <ul class="space-y-1">
                        <li>‚Ä¢ Wait longer for page load</li>
                        <li>‚Ä¢ Check browser console for errors</li>
                        <li>‚Ä¢ Verify API keys in .env.local</li>
                        <li>‚Ä¢ Try different videos/searches</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Usage Instructions -->
        <div class="bg-white border border-gray-200 p-6 rounded-lg mt-8">
            <h3 class="text-lg font-semibold text-gray-800 mb-3">üìñ How to Use</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-gray-600">
                <div>
                    <h4 class="font-semibold text-gray-800 mb-2">1. Hover</h4>
                    <p>Move your mouse over any video card and wait 0.5 seconds</p>
                </div>
                <div>
                    <h4 class="font-semibold text-gray-800 mb-2">2. Watch</h4>
                    <p>Video preview starts playing automatically (muted)</p>
                </div>
                <div>
                    <h4 class="font-semibold text-gray-800 mb-2">3. Unmute</h4>
                    <p>Click the speaker button in bottom-left to hear audio</p>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
